# この章について

この章では自作のクラスにメソッドを追加していきます。クラスメソッドとインスタンスメソッドの違いが特に重要となってきます。また、返り値について改めて取り上げ、メソッドチェーンについても解説します。

# メソッド

メソッドはRubyの世界でオブジェクトの次に重要な概念です。オブジェクトが現実世界をモデリングするツールであるとするならば、メソッドは現実世界で起こる「出来事」を記述するためのツールです。オブジェクトとメソッドを使いこなせるようになることで、機械にやってほしいことを正しく表現できるようになります。

## メソッドの種類

Rubyに限らず、オブジェクト指向の世界ではメソッドは大きく2種類に分けられます。「インスタンスメソッド」と「クラスメソッド」です（単語だけはすでに出てきていますね）。

## インスタンスメソッド

「インスタンス」については以前説明しましたね。インスタンスという単語はクラスとの対比で用いられることが多いのですが、Rubyの世界ではクラスから（主に`.new`メソッドで）生成されるオブジェクトのことをインスタンスと呼ぶのでした。

クラスはオブジェクトの種類である、という説明もありましたが、前章で行ったようにクラスを自分で定義するというのは多くの場合はインスタンスを生成したいからです（例外ももちろんたくさんあります）。文字列のクラスだけが存在して実際の文字列が存在しない、というのは奇妙な状況ですね。

さて、上述の通り、Rubyではクラスは主にインスタンスの生成のために作成されます。ということは、インスタンスのためのメソッド、すなわち「インスタンスメソッド」の定義（作成）が最も簡単になっていてほしいわけです。では、インスタンスメソッドはどのように定義するのでしょうか。

## インスタンスメソッドの定義

インスタンスメソッドの定義には`def`キーワードを用います。

```ruby
class Person
  def name
    "John Doe"
  end
end
```

紛らわしいところなのですが、この`name`メソッドを使うためには一旦`.new`してインスタンスを生成しなくてはなりません。

```ruby
class Person
  def name
    "John Doe"
  end
end

person = Person.new
puts person.name
# => John Doe
```

## 返り値とメソッドチェーンについて

以前「返り値」については軽く説明をしていますが、ここでおさらいをしつつ発展的な事柄を扱います。

Rubyでは全てのメソッドが返り値を持ちます（`return`キーワードの有無に関わらず）。これはメソッドの計算結果だと考えられます（何も計算していないと思われた方へ、制御構造の章なので細かい計算については扱います）。ここで重要なのは、Rubyでは全てのものはオブジェクトであるという点です。つまり、返り値もまたオブジェクトであるのでメソッドに応答します。ここから「メソッドチェーン」という概念が生まれます。

```ruby
class Person
  def name
    "John Doe"
  end
end

person = Person.new
puts person.name.upcase
# => JOHN DOE
```

上の例を見てください。`name`メソッドは`"John Doe"`という文字列を返しています。これはRubyでは最後に実行された行の結果が返り値となるためです。これは`String`クラスのオブジェクトであるので、`upcase`という`String`クラスのインスタンスメソッドが使えます。これは文字列を大文字に変換します。

重要なこととしては、`upcase`メソッドを`person`オブジェクトに使うことはできないという点があります（試してみてください）。あるメソッドの返り値はそのオブジェクトのクラスとは無関係であることに注意してください。

## クラスメソッドの定義

`.new`が「クラスメソッド」と呼ばれるものであることは以前お伝えしています。見た目はインスタンスメソッドと似ていますが、クラスに対して呼ばれるメソッドを一般にクラスメソッドと呼称します。

インスタンスメソッドがほぼ常にどこでも用いられるのに対し、クラスメソッドの利用頻度はやや低くなっています。これには理由があるのですが、「状態と属性」についての章で後述します。

`.new`メソッドについては前の章で解説したように`Object`クラスに由来するものですが、それ以外のクラスメソッドについては自分で定義する必要があります。例を示します。

```ruby
class Person
  def self.hello
    "Hello!"
  end
end

puts Person.hello
# => Hello!
```

以上のように、主な違いは2点あります。

1. `def <メソッド名>`ではなく、`def self.<メソッド名>`で定義する
2. 実行する際は`.new`によるインスタンス化が不要

これだけだとどうしてクラスメソッドが存在するのかの理由がわかりづらいと思います。少し発展的な例をお見せしましょう。

```ruby
class Person
  def name
    "John Doe" # 実際はデータベースの中にあるデータ
  end

  def self.find_from_database
    new # 実際はデータベースから検索している
  end
end

person = Person.find_from_database
puts person.name
# => John Doe
```

ここで、`find_from_database`メソッドに注目してください。このメソッドをインスタンスメソッドとして定義することは可能でしょうか。おそらく無理でしょう。データベースにアクセスするまで、実際の`Person`のデータは存在せず、したがってインスタンス化もできないからです。このように、例えばインスタンスを生成あるいは検索する用途などにクラスメソッドは多く用いられます。
