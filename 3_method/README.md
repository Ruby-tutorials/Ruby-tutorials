# メソッド

メソッドはオブジェクトへの命令という説明をしてきました。この章では`String`クラスのメソッドを自作することを通じてメソッドへの理解を深めます。

## おさらい

以下のコードを見てみましょう。

```ruby
puts "I love Ruby.".length
# => 12
```

ここで、"I love Ruby."のオブジェクトが`String`というクラスに属していることを思い出してみましょう。同じ`String`クラスに属している他のオブジェクトも、`length`メソッドに反応するはずです。確かめてみましょう。

```ruby
puts "I love programming.".length
# => 19
```

動きました。この状態を指して「`String`クラスに`length`メソッドが定義されている」と言うことができます。

## 自作のメソッドを`String`クラスに追加する

他のプログラミング言語では、組み込みのクラスにメソッドを追加することはできない場合が多いですが、Rubyでは可能です。これを「オープンクラス」と呼びます。

では、便利なメソッドを`String`クラスに追加します。以下のコードを実行してみましょう。

```ruby
class String
  def first
    self[0]
  end
end

puts "I love Ruby.".first
# => "I"
```

`first`メソッドを`String`クラスに追加しました。順に説明します。

### `class`キーワード

`class`キーワードはクラスを定義します（クラスの詳細についてはクラスの章を参照してください）。すでに存在するクラスに対して使われる場合はそのクラスを再度開きます。イメージとしては、「今からある名前のクラスを触るよ」と宣言するような感じです。

`class`キーワードは対応する`end`キーワードを持ちます。ここでは5行目の`end`がそれです。

### `def`キーワード

`def`キーワードはメソッドを定義します。「定義」と書きましたが、より一般的な単語としては「追加」が近いかと思います。このキーワードは基本的に`class`の中（`class`から対応する`end`までの間）に書かれます。

`def <メソッド名>`の形式で定義されたメソッドを「インスタンスメソッド」と呼びます、インスタンスメソッドはそのクラスの全てのインスタンスで利用可能になります。

### メソッドの中身

`def`からそれに対応する`end`（この場合は4行目）の間がメソッドの本体になります。何が起きているのかを充分に理解するためには、メソッドの「返り値」という概念について抑えておく必要があります。

### メソッドの返り値

Rubyでは、全てのメソッドは「返り値」を持ちます。Rubyでは`return`キーワードを使うと返り値を返すことができますが、もし`return`キーワードが存在しない場合は最後に実行された行の値（「計算結果」と考えていただいて構いません）が返り値となります。

上の例では、`self[0]`の結果が`first`メソッドの返り値となります。

では、`self[0]`は一体何をしているのでしょうか。

### `self`について

Rubyにおける`self`は、それ自体で一つの章に値する概念です。興味のある方はRubyのコードのあちこちに`p self`というコードを仕込むことで実験してみることができます。

上の例では、`self`は"I love Ruby."などの文字列インスタンスを指します。

### `[0]`について

最後に`[0]`の解説をします。

コンピュータの世界では要素の並びを`0`からカウントすることが多いです。`[0]`という記法は多くの場合、「要素の並びから先頭要素を取得する」という意味になります。ところで、文字列は「文字」の「列」であり、見方によっては「要素の並び」と言えるでしょう。したがって、この場合の`[0]`は「文字列の最初の一文字を取得する」という意味になります。

### まとめ

というわけで、1行目から5行目までのコードは「`String`クラスに、自身の最初の一文字目を返す`first`メソッドを定義する」という意味になります。このメソッドは日本語を含む任意の文字列オブジェクトに対して利用可能ですので、色々試してみてください。
